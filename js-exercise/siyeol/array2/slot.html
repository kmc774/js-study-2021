<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      //슬롯 클래스
      class Slot {
        constructor(inputAmount) {
          this._returnCoin = 0
          this._winInfo = new Array()
          this._amount = inputAmount
          this._matrix = Array.from(Array(3), () => new Array(3))
          this._shapeList = [
            { shape: "star", score: 10 },
            { shape: "square", score: 5 },
            { shape: "circle", score: 3 },
            { shape: "triangle", score: 2 },
          ]
        }

        start() {
          let rows = 0
          let columns = 0
          for (let count = 0; count < Math.pow(this._matrix.length, 2); count++) {
            this._matrix[columns][rows] = this._shapeList[parseInt(Math.random() * 4)]
            rows++
            if ((count + 1) % 3 === 0) {
              columns++
              rows = 0
            }
          }
        } // start()

        winCheck() {
          this._matrix.forEach((item, idx) => {
            let set_check = new Set() //set을 이용한 중복체크로 당첨 여부 확인
            const result = {} //당첨된 배열의 인덱스 번호를 저장후 반환할 변수
            item.map((v) => set_check.add(v))
            if (set_check.size === 1) {
              result.idx = idx
              result.shapeInfo = item[0]
              this._winInfo.push(result) //왜 푸시 안 됨?
            }
          })
        }

        output() {
          this.start()
          this.winCheck()

          this._matrix.forEach( (item) => {
            item.forEach( (item) => {
              document.writeln(item.shape + "<span class='tab'>&#9;</span>")
            })
            document.write('</br>')
          })

          if (this._winInfo.length === 0) {
            document.writeln("실패")
          } else if (this._winInfo.length > 0) {
            document.writeln("성공")
            this._winInfo.forEach((item) => { //this는 callback함수에서 사용은 지양하지 때문에 람다식 사용
              this._returnCoin += item.shapeInfo.score * this._amount             
            })
            document.writeln("coin : ", this._returnCoin )
            

          }
        }
      } // 클래스

      const slot = new Slot(3)
      slot.output()
    </script>
  </body>
</html>
