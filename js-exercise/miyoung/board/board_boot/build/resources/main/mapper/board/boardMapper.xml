<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mi.board.model.repository.BoardRepository">

    <select id="selectBoardCnt" parameterType="Object" resultType="Integer">
        SELECT COUNT(*)
        FROM BOARD
        <choose>
            <when test="type == 'all'">
                WHERE TITLE  LIKE CONCAT('%',  #{keyword}, '%')
                   OR CONTENT LIKE CONCAT('%', #{keyword}, '%')
                   OR USER_ID LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'title'">
                WHERE TITLE   LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'content'">
                WHERE CONTENT LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'userId'">
                WHERE USER_ID LIKE CONCAT('%', #{keyword}, '%')
            </when>
        </choose>
    </select>


    <select id="selectBoardList" parameterType = "Object" resultType="Board">
        SELECT    BD_IDX
                , TITLE
                , CONTENT
                , USER_ID
                , REG_DT
                , CRTN_DT
         FROM BOARD
        <choose>
            <when test="type == 'all'">
                WHERE TITLE   LIKE CONCAT('%', #{keyword}, '%')
                   OR CONTENT LIKE CONCAT('%', #{keyword}, '%')
                   OR USER_ID LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'title'">
                WHERE TITLE   LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'content'">
                WHERE CONTENT LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test="type == 'userId'">
                WHERE USER_ID LIKE CONCAT('%', #{keyword}, '%')
            </when>
        </choose>
        ORDER BY BD_IDX ${filter}
        LIMIT ${queryStart} , ${cntPerPage};
    </select>


    <insert id="insertBoard" parameterType="Board" >
        INSERT INTO BOARD
                     (
                      TITLE
                    , CONTENT
                    , USER_ID
                    , REG_DT
                     )
             VALUES (
                     #{title}
                   , #{content}
                   , #{userId}
                   , NOW()
                   )
    </insert>

    <select id="selectBoardDetail" parameterType="String" resultType="Board">
        SELECT BD_IDX , TITLE, CONTENT, USER_ID, REG_DT, CRTN_DT
        FROM BOARD
        WHERE BD_IDX = #{bdIdx};
    </select>


    <update id="updateBoard" parameterType="Board">
         UPDATE BOARD
            SET TITLE = #{title},
                CONTENT = #{content},
                CRTN_DT = NOW()
          WHERE BD_IDX = #{bdIdx};
    </update>



    <delete id="deleteBoard" parameterType="String">
        DELETE
          FROM BOARD
         WHERE BD_IDX = #{bdIdx};
    </delete>






</mapper>